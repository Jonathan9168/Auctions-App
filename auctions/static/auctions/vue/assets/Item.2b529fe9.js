import{d as E,_ as A,r as j,o as l,c,a as o,t as a,b as m,w as u,F as L,e as M,i as B,j as C}from"./index.ed948278.js";const F=E({data(){return{id:this.$route.params.id,item:[],user:"",users:[],questions:[],user_id:0,x:"Loading..."}},components:{},methods:{find_match(e){let t=e.user;for(let s=0;s<=this.users.length;s++){let i=this.users[s];if(i!=null&&t==i.user_id)return i}},timeLeft(e){var t=new Date,s=new Date(e).getTime()-t.getTime(),i=Math.floor(s/(1e3*60*60*24)),r=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),h=Math.floor(s%(1e3*60*60)/(1e3*60)),d=Math.floor(s%(1e3*60)/1e3);this.x=i+"d "+r+"h "+h+"m "+d+"s until auction end"},async fetch_item(){let e="http://127.0.0.1:8000/api/item/"+this.id+"/",t=await fetch(e,{method:"GET"});t.ok||(alert("This item does not exist"),window.location.replace("http://127.0.0.1:8000/listings"));let s=await t.json();this.item=s.item,this.fetch_user(s.item[0].user)},async fetch_user(e){let t="http://127.0.0.1:8000/api/user/"+e+"/",i=await(await fetch(t,{method:"GET"})).json();this.user=i.user[0].email},async fetch_users(e){let t="http://127.0.0.1:8000/api/user/"+e+"/",i=await(await fetch(t,{method:"GET"})).json();console.log("USERS",i);var r=this.users,h=i.user[0].email;r.push({user_id:e,email:h}),this.users=r},formatDate(e){var t=new Date(e).getHours(),s=new Date(e).getMinutes(),i=t>=12?"pm":"am";t=t%12,t=t||12;var r=s<10?"0"+s:s,h=t+":"+r+" "+i;return new Date(e).getDate()+"/"+(new Date(e).getMonth()+1)+"/"+new Date(e).getFullYear()+"  "+h},async fetch_questions(){let t=await(await fetch("http://127.0.0.1:8000/api/questions/",{method:"GET"})).json();console.log("QUESTIONS",t);let s=+this.id;this.questions=t.questions.filter(function(i,r){return i.item===s},s),console.log("FILTERED",this.questions);for(let i=0;i<this.questions.length;i++)this.fetch_users(this.questions[i].user);console.log("FETCHED",this.users)},async check_id(){let t=await(await fetch("http://127.0.0.1:8000/api/uid/",{method:"GET"})).json();this.user_id=t.id}},mounted(){this.fetch_item(),this.fetch_questions(),this.check_id(),window.setInterval(()=>{var e;return this.timeLeft((e=this.item[0])==null?void 0:e.auction_end_time)},1e3)}}),G={class:"container mt-4"},I={class:"row"},N={class:"col-sm-2 text-center mb-2"},S=["src"],$=["src"],q={class:"col-sm-8 text-center p-2 rounded",style:{"background-color":"rgb(23, 45, 125, 0.2)"}},Q={class:"text-light"},V={href:"#",class:"link-secondary"},H={class:"text-secondary"},R={class:"text-secondary"},U={class:"text-secondary"},x={class:"text-secondary"},O=o("button",{class:"btn btn-secondary"}," Ask A Question ",-1),Y=o("button",{class:"btn btn-secondary m-2"}," Make A Bid ",-1),z=o("h2",{class:"text-center"},"Questions",-1),J={class:"p-2 text-center"},K={class:"m-1 text-primary"},P={href:"#",class:"link-secondary"},W={key:0,class:"text-success"},X={key:1,class:"text-success"},Z=o("button",{class:"btn btn-secondary"},"Answer",-1);function ee(e,t,s,i,r,h){var _,p,f,w,g,y,v,k;const d=j("router-link");return l(),c("div",G,[o("div",I,[o("div",N,[((_=e.item[0])==null?void 0:_.image)!=null?(l(),c("img",{key:0,src:"http://127.0.0.1:8000/media/"+((p=e.item[0])==null?void 0:p.image),style:{width:"5em",height:"5em"}},null,8,S)):(l(),c("img",{key:1,src:"http://127.0.0.1:8000/media/default_item.png",style:{width:"5em",height:"5em"}},null,8,$))]),o("div",q,[o("h1",null,a((f=e.item[0])==null?void 0:f.title),1),o("p",Q,a((w=e.item[0])==null?void 0:w.description),1),o("p",null,[m(d,{to:"/user/"+((g=e.item[0])==null?void 0:g.user)},{default:u(()=>[o("a",V,"Item owner: "+a(e.user),1)]),_:1},8,["to"])]),o("p",H,"\xA3"+a((y=e.item[0])==null?void 0:y.starting_price),1),o("p",R," Listing date: "+a(e.formatDate((v=e.item[0])==null?void 0:v.listing_time)),1),o("p",U," Auction end: "+a(e.formatDate((k=e.item[0])==null?void 0:k.auction_end_time)),1),o("p",x," Time left until auction end: "+a(e.x),1),m(d,{to:"/question/"+e.id},{default:u(()=>[O]),_:1},8,["to"]),m(d,{to:"/bid/"+e.id},{default:u(()=>[Y]),_:1},8,["to"])])]),o("div",null,[z,(l(!0),c(L,null,M(e.questions,n=>{var D,b;return l(),c("div",J,[o("p",K,a(e.formatDate(n.time_created))+" Question: "+a(n.question),1),m(d,{to:"/user/"+((D=e.find_match(n))==null?void 0:D.user_id)},{default:u(()=>{var T;return[o("a",P,"By user: "+a((T=e.find_match(n))==null?void 0:T.email),1)]}),_:2},1032,["to"]),n.answer!=null?(l(),c("p",W,a(e.formatDate(n.answer.answered))+" Answer: "+a(n.answer.answer_text),1)):(l(),c("p",X,"Not answered yet")),((b=e.item[0])==null?void 0:b.user)==e.user_id&&n.answer==null?(l(),B(d,{key:2,to:"/Answer/"+n.id},{default:u(()=>[Z]),_:2},1032,["to"])):C("",!0)])}),256))])])}const se=A(F,[["render",ee]]);export{se as default};
